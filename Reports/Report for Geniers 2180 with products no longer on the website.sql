;WITH
    WantedProducts
    AS
    (
        -- All current products for merchant 2180
                    SELECT mp.productid
            FROM merchantprods mp
            WHERE mp.merchant_id = 2180

        UNION

            -- Explicit list of products to include even if removed
            SELECT p.Id_product
            FROM products p
            WHERE p.Id_product IN (
        612179,755689,755688,239520,333844,598216,644401,136098,711317,711315,
        569263,567187,506173,506170,505636,657054,217049,219273,383191,141517,
        656110,771262,602719,450414,378616,520338,510251,510146,510145,510132,
        484396,484384,484282,484278,440966,378480,605618,552974,664401,664417,
        802777,802778,845300,845296,419815,419796,616220,616223,616224,616257,
        616266,616276,636876,636885,636893,637014,637793,637940,644695,541081,
        541080,727794,722760,775698,775697,775695,775693,775629,775628,775626,
        759363,759361,745239,317530,771643,773811,775244,775249,775253,775255,
        775583,775584,775585,775588,775589,775590,775591,775592,775597,775607,
        775618,775619,775621,775623,775624,775625,784716,784715,776633,776605,
        776586,776582,776566,776561,776557,776537,776505,776502,776486,776477,
        776476,776474,776356,776352,776333,776325,776314,776303,776296,776265,
        776261,776257,776255,776036,775787,775772,775766,775762,775759,775758,
        775757,775730,775728,775727,775715,785620,731884,731883,731881,731880,
        792404,827660,645574,655054,773825,600054,778772,778107,778106,778105,
        778096,778095,778089,778087,777719,777718,777717,777716,860705,860713,
        860714,860723,860724,860725,860726,809240,787822,515354,515068,515063,
        512856,845825,400385,400364,400335,400334,399739,399652,399645,847324,
        564450,564448,665483,665477,665476,665470,665464,665389,665385,665339,
        665333,665321,665320,665310,665295,665293,665276,665270,665097,665042,
        665038,665032,665005,664990,648979,648944,636961,636958,636949,636796,
        636762,636249,636248,636244,792192,792190,788148,788141,317047,299207,
        299200,299078,274107,273877,269977,268297,267597,267532,265477,262093,
        257660,256960,256952,256947,256916,758396,729718,881093,881092,881091,
        881090,881089,881088,881087,881086,881085,881084,881083,881082,881081,
        881080,881055,881053,881052,881050,879703,879702,879695,879694,879691,
        879690,879686,879685,879684,879683,879667,879661,505353,505346,859807,
        859805,859801,859798,594100,594096,594095,594094,594084,594082,590242,
        590241,590240,590238,590237,590235,590233,590223,590222,590220,590219,
        590218,590217,590216,584358,584357,584355,584351,584349,584348,584346,
        584338,584308,820508,816152,816151,816143,815095,815088,412989,381871,
        371471,371363,351238,351195,342794,340857,340808,584306,584304,584301,
        584300,584299,584298,584295,584292,584287,584286,584285,584284,584283,
        529202,527274,527272,256908,256828,256813,256566,256442,256409,256278,
        256228,256216,231603,218031,218011,622884,622881,621760,600230,600228,
        600224,600221,600219,600218,600216,600129,600119,600095,600092,600062,
        600052,600051,879576,879574,872983,872980,724147,710324,710320,682204,
        682194,682175,681608,681524,681254,681127,667319,667246,784886,784883,
        784882,784880,784878,784873,784872,784867,784866,784852,784851,784601,
        784597,784595,784458,784455,776320,776319,765473,527122,820681,581034,
        537782,811690,811686,334688,225674,700365,785619,785616,350183,338211,
        338208,338204,338196,792130,792125,731885,731884,731883,731882,731881,
        722050,680319,680302,655056,645732,645731,645729,633269,633214,199189,
        196630,526199,487948,820647,393474,500438,541031,812133,811765,636711,
        631615,355370,355363,355262,355258,749434,769117,520768,582205,564932,
        322505,266401,581882,88363,731024,731023,721060,721056,721052,721051,
        721034,721031,721029,721025,721022,721004,720994,720991,720987,720983,
        720981,720979,720975,720974,720971,720969,720967,720964,720961,720960,
        720958,347485,857153,678339,678335,678330,678326,746200,743977,743975,
        743967,743946,740004,731900,731897,731896,731892,731889,731888,785337,
        806703,806702,616217,694044,544142,496663,728255,726866,738329,113409,
        587580,541975,465578,406783,299078,256965,256960,256947,816152,816151,
        351238,351195,273877,262093,256566,140922,664607,664582,724421,724420,
        724406,740697,594091,565538,563175,555023,529099,528910,528883,448940,
        448915,448887,357140,280948,256934,218844,218839,218834,218652,218650,
        218646,218643,218637,218557,218546,215313,189289,755879,755878,664885,
        653416,653412,628215,628205,801748,769741,769739,769735,751611,751312,
        749044,749042,705532,700279,692944,688402,688345,678212,657293,657291,
        657112,639042,639039,639036,639034,614644,602045,602041,602040,602034,
        602028,602022,602021,601903,601718,279913,794406,794405,794402,550121,
        846955,622884,622881,816143,724147,256442,256409,256278,256228,256216,
        764881,738679,738672,601034,824339,824333,824330,824329,333844,239520,
        499172,845286,845282,845281,609377,609347
    )
    )
SELECT DISTINCT
    p.id_product AS TailbaseID,
    ISNULL(p.manufmodel, p.model) AS Model,
    sp.SpecValue_1 AS UPC,
    co.cie,
    c.category,
    sc.subcategory,
    'http://tmimages.tailbase.com/prods/' + CAST(p.id_product AS VARCHAR(10)) + '_100X100.jpg' AS ImageUrl,
    ISNULL(p.descriptiveTitleUSA_1, p.descriptiveTitle_1) AS Title,
    mp.ptr,
    mp.liquidation,
    mp.cost,
    mp.fee AS Ecofee,
    mp.new AS IsNew,
    mp.lock AS isLocked,
    mp.CreationDate AS DateCreation,
    mp.ModifDate AS DateModification,
    mp.newEndDate,
    mp.newStartDate,
    mp.PriceQualifier,
    mp.reducedPrice,
    mp.reducedPriceEndDate,
    mp.reducedPriceStartDate,
    mp.refurbished,
    mp.price,
    mp.specialBuy,
    mp.specialBuyEndDate,
    mp.specialBuyStartDate,
    mp.storeonly,
    mp.webonly,
    mp.qty,
    CASE 
        WHEN mp.productid IS NULL THEN 'NO'
        ELSE 'YES'
    END AS IsProductOnTheWebsite
FROM WantedProducts wp
    JOIN products p ON p.id_product = wp.productid
    LEFT JOIN merchantprods mp
    ON mp.productid = p.id_product
        AND mp.merchant_id = 2180
    JOIN categories c
    ON c.id_category = p.catid AND c.id_langue = 1
    JOIN companies co
    ON co.id_cie = p.manufid
    JOIN subcategories sc
    ON sc.id_subcategory = p.subcatid AND sc.id_langue = 1
    JOIN specs s
    ON s.CatId = p.catID AND s.catid = c.id_category AND s.spec = 'UPC#'
    JOIN SpecsProd sp
    ON sp.productID = p.id_product AND s.ID = sp.specsID_1;